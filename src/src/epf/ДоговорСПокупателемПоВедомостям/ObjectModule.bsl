Функция СведенияОВнешнейОбработке() Экспорт

	ПараметрыРегистрации = Новый Структура;
	МассивНазначений     = Новый Массив;
	МассивНазначений.Добавить( "Справочник.ДоговорыКонтрагентов" );
	ПараметрыРегистрации.Вставить( "Вид", "ПечатнаяФорма" );
	ПараметрыРегистрации.Вставить( "Назначение", МассивНазначений );
	ПараметрыРегистрации.Вставить( "Наименование", "Договор отпуска нефтепродуктов по ведомости или топливным картам" ); //имя под которым обработка будет зарегестрирована в справочнике внешних обработок
	ПараметрыРегистрации.Вставить( "БезопасныйРежим", ЛОЖЬ );
	ПараметрыРегистрации.Вставить( "Версия", "1.0" );
	ПараметрыРегистрации.Вставить( "Информация", "Печатная форма договора отпуска нефтепродуктов по ведомости или топливным картам" );
	ТаблицаКоманд = ПолучитьТаблицуКоманд();
	ДобавитьКоманду( ТаблицаКоманд, "Договор отпуска нефтепродуктов по ведомости или топливным картам", "ДоговорПоставкиВедомостьТопливныеКарты", "ВызовСерверногоМетода", Истина, "ПечатьMXL" );
	ПараметрыРегистрации.Вставить( "Команды", ТаблицаКоманд );
	
	Возврат ПараметрыРегистрации;
	

КонецФункции

#Область Падежи

// Функция для склонения одного слова!!!
// z1 - само слово// z2 - номер падежа// z3 - пол
// z4 - 1-склонять как фамилию, 2-имя, 3-отчество

Функция ПадежС(z1,Знач z2=2,Знач z3="*",z4=0) Экспорт
	z5=Найти(z1,"-");
	z6=?(z5=0,"","-"+ПадежС(Сред(z1,z5+1,СтрДлина(z1)-z5+1),z2,z3,z4));
	z1=НРег(?(z5=0,z1,Лев(z1,z5-1)));
	z7=Прав(z1,3);z8=Прав(z7,2);z9=Прав(z8,1);
	z5=СтрДлина(z1);
	za=Найти("ая ия ел ок яц ий па да ца ша ба та га ка",z8);
	zb=Найти("аеёийоуэюяжнгхкчшщ",Лев(z7,1));
	zc=Макс(z2,-z2);
	zd=?(za=4,5,Найти("айяь",z9));
	zd=?((zc=1)или(z9=".")или((z4=2)и(Найти("оиеу"+?(z3="ч","","бвгджзклмнпрстфхцчшщъ"),z9)>0))или((z4=1)и(Найти("мия мяэ лия кия жая лея",z7)>0)),9,?((zd=4)и(z3="ч"),2,?(z4=1,?(Найти("оеиую",z9)+Найти("их ых аа еа ёа иа оа уа ыа эа юа яа",z8)>0,9,?(z3<>"ч",?(za=1,7,?(z9="а",?(za>18,1,6),9)),?(((Найти("ой ый",z8)>0)и(z5>4)и(Прав(z1,4)<>"опой"))или((zb>10)и(za=16)),8,zd))),zd)));
	ze=Найти("лец вей бей дец пец мец нец рец вец аец иец ыец бер",z7);
	zf=?((zd=8)и(zc<>5),?((zb>15)или(Найти("жий ний",z7)>0),"е","о"),?(z1="лев","ьв",?((Найти("аеёийоуэюя",Сред(z1,z5-3 ,1))=0)и((zb>11)или(zb=0))и(ze<>45),"",?(za=7,"л",?(za=10,"к",?(za=13,"йц",?(ze=0,"",?(ze<12,"ь"+?(ze=1,"ц",""),?(ze<37,"ц",?(ze<49,"йц","р"))))))))));
	zf=?((zd=9)или((z4=3)и(z3="ы")),z1,Лев(z1,z5-?((zd>6)или(zf<>""),2,?(zd>0,1,0)))+zf+СокрП(Сред("а у а "+Сред("оыые",Найти("внч",z9)+1,1)+"ме "+?(Найти("гжкхш",Лев(z8,1))>0,"и","ы")+" е у ойе я ю я ем"+?(za=16,"и","е")+" и е ю ейе и и ь ьюи и и ю ейи ойойу ойойойойуюойойгомуго"+?((zf="е")или(za=16)или((zb>12)и(zb<16)),"и","ы")+"мм",10*zd+2*zc-3,2)));Возврат ?(""=z1,"",?(z4>0,ВРег(Лев(zf,1))+?((z2<0)и(z4>1),".",Сред(zf,2)),zf)+z6);
КонецФункции

//_____________________________________________________________________________
// z1 - фамилия имя отчество например Железняков Юрий Юрьевич
// z2 - Падеж ( по  умолчанию = 2 - родительный)// 2 - родительный  ( нет кого?    ) Железнякова Юрия Юрьевича     
// 3 - дательный    ( кому?        ) Железнякову Юрию Юрьевичу 
// 4 - винительный  ( вижу кого?   ) Железнякова Юрия Юрьевича  
// 5 - творительный ( кем?         ) Железняковым Юрием Юрьевичем    
// 6 - предложный   ( о ком?       ) Железнякове Юрии Юрьевиче 
// Если задать Z2 меньше 0, то на выходе получим от -1=Железняков Ю. Ю. до -6=Железнякове Ю. Ю.
// z3 - параметр Пол может не указываться, но при наличии фамилий с 
// параметром  1 - мужской 2 - женский  
// ДЛЯ СКЛОНЕНИЯ ПРОФЕССИЙ ИСПОЛЬЗУЙТЕ ФУНКЦИЮ ПАДЕЖП И БУДЕТ ВАМ СЧАСТЬЕ!
// ---------------------------------------------------------------------------------------
// Если Падеж(Фио ,1 ,3),       то на выходе получим Фамилия Имя Отчество и т.д.
// Если Падеж(Фио ,1 ,3,"1" ),  то                   Фамилия 
// Если Падеж(Фио ,1 ,3,"2" ),  то                   Имя 
// Если Падеж(Фио ,1 ,3,"3" ),  то                   Отчество 
// Если Падеж(Фио, 1 ,3,"12" ), то                   Фамилия Имя 
// Если Падеж(Фио, 1 ,3,"23" ), то                   Имя Отчество 
// Если Падеж(Фио,-1 ,3,"231" ),то                   И. О. Фамилия 
// Если Падеж(Фио,-1 ,3,"23" ), то                   И. О.  

Функция Падежик(Знач z1,z2=2,z3=3,Знач z4="123",z5=1) Экспорт
	Возврат?(z5<4,Падежик(СокрЛП(СтрЗаменить(Сред(z1,Найти(z1+" "," ")+1),".",". ")),z2,z3,СтрЗаменить(z4,z5,ПадежС(Лев(z1,Найти(z1+" "," ")-1),z2,Сред("ча"+НРег(Прав(СокрП(z1),1)),z3,1),z5)+" "),z5+1),z4);
КонецФункции//Падежик

Функция Падеж(Знач z1,z2=2,z3=3,Знач z4="123") Экспорт
	z1=СокрП(z1);
	z5=Прав(z1,4);
	z6=Найти("оглы кызы",z5);
	Возврат Падежик(?(z6>0,Лев(z1,СтрДлина(z1)-5),z1),z2,z3,z4)+?(z6>0,z5,"");
КонецФункции//Падеж

Функция ПадежП(Знач z1,Знач z2,z3=0) Экспорт
	z1=СокрЛП(z1);z4=Найти(z1+" "," ")+1;z5=Лев(z1,z4-2);z6=Прав(z5,2);
	z7=?((Найти("ая ий ый",z6)>0)и(Найти("ющий нный",Сред(z1,z4-5,4))=0)и(z3=0),"1","*");
	Возврат НРег(?((z6="ая")или(Прав(z6,1)="а"),ПадежС(z5,z2,z7,1)+" "+ПадежС(Сред(z1,z4),z2),ПадежС(z5,z2,"ч",1)+?((z6="ий")и(Найти(z1," ")=0),""," "+?(z7="1",ПадежП(Сред(z1,z4),z2,Число(z7)),Сред(z1,z4)))));
КонецФункции//ПадежП// (c) Jurer Production End ( Finish )

#КонецОбласти

Функция ПолучитьТаблицуКоманд()
	
	Команды = Новый ТаблицаЗначений;
	Команды.Колонки.Добавить( "Представление", Новый ОписаниеТипов( "Строка" ) ); //как будет выглядеть описание печ.формы для пользователя
	Команды.Колонки.Добавить( "Идентификатор", Новый ОписаниеТипов( "Строка" ) ); //имя макета печ.формы
	Команды.Колонки.Добавить( "Использование", Новый ОписаниеТипов( "Строка" ) ); //ВызовСерверногоМетода
	Команды.Колонки.Добавить( "ПоказыватьОповещение", Новый ОписаниеТипов( "Булево" ) );
	Команды.Колонки.Добавить( "Модификатор", Новый ОписаниеТипов( "Строка" ) );
	
	Возврат Команды;

КонецФункции

Процедура ДобавитьКоманду(ТаблицаКоманд, Представление, Идентификатор, Использование, ПоказыватьОповещение = Ложь, Модификатор = "")

НоваяКоманда = ТаблицаКоманд.Добавить();
НоваяКоманда.Представление = Представление; 
НоваяКоманда.Идентификатор = Идентификатор;
НоваяКоманда.Использование = Использование;
НоваяКоманда.ПоказыватьОповещение = ПоказыватьОповещение;
НоваяКоманда.Модификатор = Модификатор;

КонецПроцедуры

Процедура Печать(МассивОбъектов, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт

УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "ДоговорПоставкиВедомостьТопливныеКарты", "Договор отпуска нефтепродуктов по ведомости или топливным картам", СформироватьПечатнуюФорму(МассивОбъектов[0], ОбъектыПечати));

КонецПроцедуры // Печать()

Функция СформироватьПечатнуюФорму(ДоговорСсылка, ОбъектыПечати)

	ТабличныйДокумент = Новый ТабличныйДокумент;
	ТабличныйДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ДоговорПоставкиВедомостьТопливныеКарты";
	
	МакетОбработки = ПолучитьМакет( "ДоговорПоставкиВедомостьТопливныеКарты" );
	
	Если Не ДоговорСсылка.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СПокупателем Тогда
		
		ОбластьОшибка = МакетОбработки.ПолучитьОбласть( "ОшибкаВыполнения" );
		ТабличныйДокумент.Вывести( ОбластьОшибка );
		
	Иначе
		
		РеквизитыДоговора = Справочники.ДоговорыКонтрагентов.ПодготовитьПараметрыПечатиТекстаДоговора( ДоговорСсылка );
		ОбластьШапка      = МакетОбработки.ПолучитьОбласть( "Шапка" );
		ОбластьШапка.Параметры.НомерДоговора = РеквизитыДоговора.Номер;
		ОбластьШапка.Параметры.ДатаДоговора  = Формат ( РеквизитыДоговора.Дата, "ДФ='dd MMMM yyyy ""г.""'" );
		
		// данные организации
		СведенияОбОрганизации = БухгалтерскийУчетПереопределяемый.СведенияОЮрФизЛице( ДоговорСсылка.Организация,
																					  ДоговорСсылка.Дата );
		ПредставлениеОрганизации = ОбщегоНазначенияБПВызовСервера.ОписаниеОрганизации( СведенияОбОрганизации,
																					   "НаименованиеДляПечатныхФорм," );
		ОбластьШапка.Параметры.Организация          = ПредставлениеОрганизации;
		ОбластьШапка.Параметры.Организация = ПредставлениеОрганизации;
		ОбластьШапка.Параметры.ПодписантОрганизация = ? (ВРег(ДоговорСсылка.ДолжностьРуководителя.Наименование) = "ДОВЕРЕННОЕ ЛИЦО", "доверенного лица", ПадежП(ДоговорСсылка.ДолжностьРуководителя.Наименование, 2, 0));
		ОбластьШапка.Параметры.ФИОПодписантаОрганизация = СокрЛП(Падеж(ДоговорСсылка.Руководитель, 2,
		? (ДоговорСсылка.Руководитель.Пол = Перечисления.ПолФизическогоЛица.Мужской, 1, 2), "123"));
		ОбластьШапка.Параметры.ОснованиеПолномочийОрганизация = ? (ЗначениеЗаполнено(ДоговорСсылка.ЗаРуководителяПоПриказу),
		ДоговорСсылка.ЗаРуководителяПоПриказу,"Устава");

																 
		// данные контрагента
		СведенияОКонтрагенте = БухгалтерскийУчетПереопределяемый.СведенияОЮрФизЛице( ДоговорСсылка.Владелец,
																					 ДоговорСсылка.Дата );
		ПредставлениеКонтрагента = ОбщегоНазначенияБПВызовСервера.ОписаниеОрганизации( СведенияОКонтрагенте,
																					   "НаименованиеДляПечатныхФорм," );
		ОбластьШапка.Параметры.Контрагент          = ПредставлениеКонтрагента;
		ОбластьШапка.Параметры.ПодписантКонтрагент = ПадежП(ДоговорСсылка.ДолжностьРуководителяКонтрагента, 2, 0);
		ОбластьШапка.Параметры.ФИОПодписантаКонтрагент = СокрЛП(Падеж(ДоговорСсылка.РуководительКонтрагента, 2,
		? (ДоговорСсылка.ПолРуководителяКонтрагента = Перечисления.ПолФизическогоЛица.Мужской, 1, 2), "123"));
		
		ОбластьШапка.Параметры.ОснованиеПолномочийКонтрагент = ? (
		ЗначениеЗаполнено(
		ДоговорСсылка.ЗаРуководителяКонтрагентаПоПриказу),
		ДоговорСсылка.ЗаРуководителяКонтрагентаПоПриказу,"Устава");

		
		// выводим шапку в табличный документ
		ТабличныйДокумент.Вывести( ОбластьШапка );
		
		ОбластьДанные = МакетОбработки.ПолучитьОбласть( "Данные" );
		//ОбластьДанные.Параметры.Контрагент = ОбластьШапка.Параметры.Контрагент;
		//ОбластьДанные.Параметры.ПодписантКонтрагент     = ОбластьШапка.Параметры.ПодписантКонтрагент;
		//ОбластьДанные.Параметры.ФИОПодписантаКонтрагент = ОбластьШапка.Параметры.ФИОПодписантаКонтрагент;
		ОбластьДанные.Параметры.СрокДействияДоговора    = Формат ( ДоговорСсылка.СрокДействия, "ДФ='dd MMMM yyyy ""г.""'" );
		ТабличныйДокумент.Вывести( ОбластьДанные );
		
		
		// //заполняем подвал
		ОбластьПодвал = МакетОбработки.ПолучитьОбласть( "Подвал" );
		
		// организация
		ОбластьПодвал.Параметры.Организация    = ПредставлениеОрганизации;
		ОбластьПодвал.Параметры.ИННОрганизация = ДоговорСсылка.Организация.ИНН;
		
		
		ОбластьПодвал.Параметры.ЮрАдресОрганизация       = СведенияОбОрганизации.ЮридическийАдрес;
		ОбластьПодвал.Параметры.ПочтАдресОрганизация     = СведенияОбОрганизации.ПочтовыйАдрес;
		ОбластьПодвал.Параметры.РасчетныйСчетОрганизация = СведенияОбОрганизации.НомерСчета;
		ОбластьПодвал.Параметры.БанкОрганизация          = СведенияОбОрганизации.Банк;
		ОбластьПодвал.Параметры.КоррСчетОрганизация      = СведенияОбОрганизации.КоррСчет;
		ОбластьПодвал.Параметры.БИКОрганизация           = СведенияОбОрганизации.БИК;
		ОбластьПодвал.Параметры.ОКПООрганизация          = СведенияОбОрганизации.КодПоОКПО;
		ОбластьПодвал.Параметры.ОКВЭДОрганизация         =
		
			//ДоговорСсылка.Организация.КодОКВЭД + ", " +
		ДоговорСсылка.Организация.КодОКВЭД2;
		ОбластьПодвал.Параметры.ЭлПочтаОрганизация       = СведенияОбОрганизации.Email;
		ОбластьПодвал.Параметры.ТелефоныОрганизация      = СведенияОбОрганизации.Телефоны;
		ОбластьПодвал.Параметры.ПодписантОрганизация     = ДоговорСсылка.ДолжностьРуководителя.Наименование;
		ОбластьПодвал.Параметры.ФИОПОдписантаОрганизация = ФизическиеЛицаКлиентСервер.ФамилияИнициалы( ДоговорСсылка.Руководитель.ФИО );
		
		// Контрагент
		ОбластьПодвал.Параметры.Контрагент    = ПредставлениеКонтрагента;
		ОбластьПодвал.Параметры.ИННКонтрагент = ДоговорСсылка.Владелец.ИНН;
		
		
		ОбластьПодвал.Параметры.ЮрАдресКонтрагент       = СведенияОКонтрагенте.ЮридическийАдрес;
		ОбластьПодвал.Параметры.ПочтАдресКонтрагент     = СведенияОКонтрагенте.ПочтовыйАдрес;
		ОбластьПодвал.Параметры.РасчетныйСчетКонтрагент = СведенияОКонтрагенте.НомерСчета;
		ОбластьПодвал.Параметры.БанкКонтрагент          = СведенияОКонтрагенте.Банк;
		ОбластьПодвал.Параметры.КоррСчетКонтрагент      = СведенияОКонтрагенте.КоррСчет;
		ОбластьПодвал.Параметры.БИККонтрагент           = СведенияОКонтрагенте.БИК;
		ОбластьПодвал.Параметры.ЭлПочтаКонтрагент       = СведенияОКонтрагенте.Email;
		ОбластьПодвал.Параметры.ТелефоныКонтрагент      = СведенияОКонтрагенте.Телефоны;
		ОбластьПодвал.Параметры.ПодписантКонтрагент     = ДоговорСсылка.ДолжностьРуководителяКонтрагента;
		ОбластьПодвал.Параметры.ФИОПОдписантаКонтрагент = ФизическиеЛицаКлиентСервер.ФамилияИнициалы( ДоговорСсылка.РуководительКонтрагента );
		
		
		ТабличныйДокумент.Вывести( ОбластьПодвал );
		
	КонецЕсли;
	
	ТабличныйДокумент.АвтоМасштаб = Истина;
	
	Возврат ТабличныйДокумент;

КонецФункции